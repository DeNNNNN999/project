Тема #6 (Node.js): Встроенные Модули (path, os, events)

1. Модуль path – Работа с Путями к Файлам

Зачем? Пути к файлам записываются по-разному в разных ОС:
Windows: C:\Users\Documents\file.txt (использует \ и буквы дисков)
Linux/macOS: /home/user/documents/file.txt (использует /) Модуль path предоставляет кросс-платформенные утилиты для работы с путями, чтобы ваш код работал одинаково везде.
Ключевые Методы:
path.join(...paths): Самый важный метод! Соединяет сегменты пути, используя правильный разделитель для текущей ОС (\ или /), и нормализует результат (убирает лишние слэши, точки ., обрабатывает ..).
JavaScript

const path = require('path');

const userDir = 'users';
const userId = '123';
const filename = 'data.json';

// НЕПРАВИЛЬНО (не кросс-платформенно, могут быть лишние слэши):
// const badPath = __dirname + '/' + userDir + '//' + userId + '/' + filename;

// ПРАВИЛЬНО:
const goodPath = path.join(__dirname, userDir, userId, filename);
console.log(goodPath);
// На Windows: C:\...\your_project\users\123\data.json
// На Linux: /home/.../your_project/users/123/data.json
path.resolve(...paths): Преобразует последовательность путей в абсолютный путь. Идет справа налево, пока не встретит абсолютный путь, затем присоединяет остальное слева. Если абсолютных частей нет, использует текущую рабочую директорию.
JavaScript

console.log(path.resolve('tmp', 'data', '../', 'logs/app.log'));
// Вернет абсолютный путь к 'logs/app.log' относительно текущей папки
// Например: /Users/me/myproject/logs/app.log
path.basename(filePath[, ext]): Получить имя файла из пути (опционально убрав расширение). path.basename('/users/data/file.txt') -> 'file.txt' path.basename('/users/data/file.txt', '.txt') -> 'file'
path.dirname(filePath): Получить путь к директории файла. path.dirname('/users/data/file.txt') -> '/users/data'
path.extname(filePath): Получить расширение файла. path.extname('/users/data/file.txt') -> '.txt'
path.sep: Разделитель пути для текущей ОС (\ или /).
Критический взгляд: Никогда не конкатенируйте пути вручную с помощью строк! Это почти гарантированно приведет к проблемам на другой ОС. Всегда используйте path.join и path.resolve для надежной работы с путями.
2. Модуль os – Информация об Операционной Системе

Зачем? Позволяет получить информацию о системе, на которой запущен Node.js процесс. Полезно для логов, условной логики или сбора системной информации.
Ключевые Методы/Свойства:
os.platform(): Строка, идентифицирующая ОС ('win32', 'linux', 'darwin' для macOS).
os.arch(): Архитектура процессора ('x64', 'arm', 'ia32').
os.cpus(): Массив объектов с информацией о каждом логическом ядре CPU (модель, скорость).
os.totalmem(): Общий объем ОЗУ в байтах.
os.freemem(): Свободный объем ОЗУ в байтах.
os.homedir(): Путь к домашней директории текущего пользователя.
os.tmpdir(): Путь к системной временной папке.
os.hostname(): Имя хоста машины.
os.EOL: Символ(ы) конца строки для текущей ОС ('\r\n' для Windows, '\n' для Linux/macOS). Критически важно использовать при записи текстовых файлов, чтобы они корректно отображались в разных редакторах/системах.
Критический взгляд: Полезный модуль для получения системной информации, но старайтесь не завязывать ключевую логику вашего приложения на специфику конкретной ОС, если хотите сохранить кросс-платформенность. os.EOL — важная деталь при работе с текстом.
3. Модуль events и EventEmitter – Основа Событийной Модели

Зачем? Node.js сильно ориентирован на события. Этот модуль предоставляет класс EventEmitter, реализующий паттерн Наблюдатель (Observer) или Издатель-Подписчик (Publish/Subscribe). Он позволяет объектам "излучать" (emit) именованные события, а другим частям кода "слушать" (listen/subscribe) эти события и реагировать на них.
Ключевой класс: EventEmitter.
Основные Методы:
emitter.on('eventName', listenerFunction) или addListener(): Подписать функцию listenerFunction на событие eventName. Можно подписать несколько слушателей на одно событие.
emitter.once('eventName', listenerFunction): Подписать функцию, которая сработает только один раз при первом возникновении события, а затем автоматически отпишется.
emitter.emit('eventName', arg1, arg2, ...): Сгенерировать событие eventName. Все подписанные на него слушатели будут вызваны синхронно (в порядке подписки), получив arg1, arg2, ... в качестве аргументов.
emitter.off('eventName', listenerFunction) или removeListener(): Отписать конкретную функцию-слушатель от события.
emitter.removeAllListeners(['eventName']): Удалить всех слушателей (либо для конкретного события, либо вообще всех).
Пример:
JavaScript

const EventEmitter = require('events');

class MyEmitter extends EventEmitter {} // Можно наследоваться

const myEmitter = new MyEmitter();

// Подписываем слушателя
myEmitter.on('data_received', (data) => {
  console.log('Получены данные:', data);
});

myEmitter.once('start', () => {
  console.log('Процесс запущен (сработает 1 раз)');
});

// Стандартный паттерн: обработка ошибок через событие 'error'
myEmitter.on('error', (err) => {
  console.error('Произошла ошибка эмиттера:', err.message);
});

console.log("Эмитируем события:");
myEmitter.emit('start');
myEmitter.emit('data_received', { id: 1, value: 'Hello' });
myEmitter.emit('data_received', { id: 2, value: 'World' });
myEmitter.emit('start'); // Это событие 'start' уже не будет обработано (т.к. был once)
myEmitter.emit('error', new Error('Что-то пошло не так'));
// myEmitter.emit('error', new Error('Еще одна')); // Если нет слушателя 'error', процесс упадет!
Критический взгляд: EventEmitter — это фундаментальный паттерн в Node.js. Многие встроенные модули (http.Server, ReadableStream/WritableStream, child_process) являются наследниками EventEmitter. Понимание этого паттерна ключевое для работы с асинхронностью в Node. Он позволяет создавать слабо связанные компоненты (излучатель не знает о слушателях). Однако, для сложных потоков управления он может быть менее наглядным, чем Промисы или async/await. Очень важно: По конвенции, ошибки эмиттеры сообщают через событие 'error'. Если такое событие произошло, а на него нет ни одного подписчика, Node.js аварийно завершит процесс! Поэтому всегда вешайте обработчик на 'error', если есть вероятность его возникновения.
Итог по Теме #6:

Модули path, os и events предоставляют базовые, но незаменимые инструменты. path обеспечивает кросс-платформенную работу с путями. os дает информацию о системе. events (EventEmitter) реализует ключевой для Node.js событийно-ориентированный паттерн, используемый во многих других модулях.
