# Тема #5: NPM и package.json

## 1. Что такое NPM и package.json?

### NPM (Node Package Manager)
Это стандартный менеджер пакетов для Node.js и всей экосистемы JavaScript. Он состоит из двух частей:

- **CLI-инструмент (npm)**: Утилита командной строки для установки, обновления, удаления пакетов и запуска скриптов.
- **Реестр пакетов (npmjs.com)**: Огромная онлайн-база данных, где разработчики публикуют и скачивают переиспользуемые модули кода (пакеты/библиотеки).

### package.json
Манифест проекта. JSON-файл в корне вашего проекта, который содержит:

- **Метаданные**: Имя проекта, версия, описание, автор, лицензия и т.д.
- **Зависимости**: Список сторонних пакетов, необходимых для работы проекта.
- **Скрипты**: Команды для автоматизации задач (запуск, сборка, тесты).
- **Конфигурацию**: Настройки для самого проекта или связанных инструментов (например, `"type": "module"`).

## 2. Ключевые Поля package.json

- **name**: Имя вашего пакета (уникальное, если публикуете в npm).
- **version**: Версия пакета, обычно по Семантическому Версионированию (SemVer): МАЖОРНАЯ.МИНОРНАЯ.ПАТЧ (например, 1.2.3).
- **description**: Краткое описание.
- **main**: Точка входа для CommonJS модулей (файл, который будет загружен, когда кто-то сделает `require('имя-вашего-пакета')`). Обычно index.js.
- **module**: Неофициальное, но часто используемое поле для указания точки входа для ES Modules.
- **type**: `"commonjs"` (по умолчанию) или `"module"` (указывает Node.js, что файлы .js в этом пакете — это ES Modules).
- **scripts**: Объект, где ключи — это имена скриптов, а значения — команды оболочки. Запускаются через `npm run <имя_скрипта>`. Стандартные: `start`, `test`.

```json
"scripts": {
  "start": "node src/server.js",
  "dev": "nodemon src/server.js",
  "build": "tsc",
  "test": "jest"
}
```

- **dependencies**: Основные зависимости. Пакеты, необходимые для работы вашего приложения в production. Устанавливаются через `npm install <пакет>` (или `npm i <пакет>`).
- **devDependencies**: Зависимости для разработки. Пакеты, нужные только во время разработки и сборки (TypeScript, Jest, ESLint, Webpack, Nodemon и т.д.). Устанавливаются через `npm install --save-dev <пакет>` (или `npm i -D <пакет>`).

  **Важно**: Правильное разделение помогает уменьшить размер финальной сборки/установки в production.

## 3. Управление Зависимостями

### node_modules
Папка, куда `npm install` скачивает все зависимости проекта и их собственные зависимости (рекурсивно). Часто имеет огромный размер.

### Семантическое Версионирование (SemVer) и Диапазоны
В dependencies версии часто указываются с префиксами:

- **^1.2.3** (Caret): Разрешает обновления патчей и минорных версий (до <2.0.0). Самый частый вариант.
- **~1.2.3** (Tilde): Разрешает только обновления патчей (до <1.3.0). Более строгий.
- **1.2.3** (Точная версия): Установит только эту версию.

**Критический взгляд**: SemVer — это соглашение. Оно работает, только если авторы пакетов ему следуют. Случайные "ломающие" изменения в минорных или патч-версиях случаются. Поэтому нужен механизм блокировки версий.

### package-lock.json (или yarn.lock, pnpm-lock.yaml)
**Критически важный файл!**

- **Что делает**: Автоматически генерируется `npm install`/`update`. Записывает точные версии (1.2.4, а не ^1.2.3) всех установленных пакетов, включая зависимости зависимостей, и их контрольные суммы.
- **Зачем?** Гарантия Воспроизводимости Сборки! Когда другой разработчик (или CI/CD система) клонирует проект и запускает `npm install`, npm использует package-lock.json, чтобы установить точно такие же версии всех пакетов, которые работали у вас. Это предотвращает ошибки "у меня работает, а у тебя нет" из-за неявных обновлений зависимостей.
- **Обязательно коммитить в Git!**

### Альтернативные Менеджеры (yarn, pnpm)
Решают некоторые проблемы npm (исторически — скорость, консистентность lock-файлов, размер node_modules). pnpm особенно интересен тем, что использует хитрую систему ссылок, чтобы не дублировать одни и те же пакеты в node_modules много раз, экономя дисковое пространство.

## 4. Основные Команды NPM

- **npm init / npm init -y**: Создать package.json.
- **npm install / npm i**: Установить все зависимости из package.json / package-lock.json.
- **npm install <пакет>**: Установить пакет и добавить в dependencies.
- **npm i -D <пакет>**: Установить пакет и добавить в devDependencies.
- **npm update**: Обновить пакеты до последних версий, разрешенных диапазонами в package.json, и обновить package-lock.json.
- **npm outdated**: Показать пакеты, для которых доступны обновления.
- **npm uninstall <пакет>**: Удалить пакет.
- **npm run <имя_скрипта>**: Запустить скрипт из секции scripts. (`npm start` и `npm test` можно без run).
- **npx <команда>**: Выполнить команду пакета без глобальной установки. npx скачает пакет (если нужно), выполнит команду и удалит его (или использует уже установленный локально). Очень удобно для CLI-утилит (`npx create-react-app my-app`, `npx tsc --init`).

## 5. Безопасность

**npm audit**: Проверяет установленные зависимости на наличие известных уязвимостей в базах данных.

**Критический взгляд**: Реестр npm огромен, и не все пакеты одинаково надежны или безопасны. Установка зависимостей — это выполнение чужого кода. Важно следить за уязвимостями и использовать package-lock.json.

## Итог

npm и package.json — это фундаментальные инструменты экосистемы Node.js (и большей части фронтенда). Они решают ключевую задачу управления зависимостями и автоматизации задач проекта.

Понимание роли package.json, различия dependencies и devDependencies, принципов SemVer и критической важности package-lock.json для воспроизводимости сборок — обязательные знания для любого разработчика в этой экосистеме.

Альтернативы вроде yarn и pnpm решают некоторые проблемы npm, но базовые концепции остаются теми же.
