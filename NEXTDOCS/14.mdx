# Тема 14: layout.js vs template.js в Next.js App Router: Зачем Два Почти Одинаковых Файла?

## Введение: Структурируем UI Сегмента

App Router в Next.js ввел мощную систему макетов (Layouts) с помощью файла `layout.js`. Это позволяет определять общую структуру UI, которая оборачивает страницы (`page.js`) или дочерние макеты внутри определенного сегмента роута (папки). Но рядом с `layout.js` в документации и возможностях App Router фигурирует и `template.js`.

На первый взгляд, они делают похожие вещи — оба принимают `children` и оборачивают их. Но их поведение при навигации принципиально отличается, и это отличие связано с сохранением состояния. Зачем Next.js понадобились два таких похожих файла? В чем их реальная разница и когда использовать каждый из них?

## layout.js (Макеты) – Постоянство и Состояние

### Назначение:
Создание общего, постоянного UI для группы страниц или целого раздела сайта. Идеально подходит для шапок, подвалов, боковых панелей навигации, любых элементов, которые не должны меняться при переходе между страницами внутри этого раздела.

### Поведение при Навигации (Ключевое!):
Когда пользователь перемещается между страницами (`page.js`), которые используют один и тот же `layout.js` (т.е., находятся в той же папке или ее подпапках, до следующего `layout.js`), сам компонент Layout **НЕ перемонтируется** (не проходит unmount/remount).

- **Состояние Сохраняется**: Если `layout.js` является клиентским компонентом (`"use client";`) и использует `useState` или `useReducer`, его состояние сохраняется между навигациями.
- **DOM Сохраняется**: DOM-элементы, отрендеренные самим Layout, также сохраняются, что эффективно.
- **Перерендериваются только children**: При смене страницы меняется только та часть, которая рендерится на месте `{children}`.

**Пример**: Навигационная панель в `dashboard/layout.js` останется на месте и сохранит свое состояние (например, активный пункт), когда вы переходите между `dashboard/profile/page.js` и `dashboard/settings/page.js`.

## template.js (Шаблоны) – Пересоздание при Навигации

### Назначение:
Также позволяет создать обертку для children (страницы или дочернего layout'а), но с противоположным поведению Layout'а свойством. Template предназначен для случаев, когда вам нужен UI или логика, которые должны пересоздаваться или перезапускаться при каждой навигации между страницами одного уровня иерархии.

### Поведение при Навигации (Ключевое!):
Когда пользователь перемещается между страницами, использующими один и тот же `template.js`, для новой страницы **создается новый экземпляр** компонента Template. Он монтируется заново:

- **Состояние НЕ Сохраняется**: Любое состояние (`useState`) внутри Template будет сброшено при навигации.
- **DOM Пересоздается**: DOM-элементы Template пересоздаются.
- **Эффекты Перезапускаются**: `useEffect` (без зависимостей или с зависимостями, которые меняются) будет запущен заново при монтировании нового экземпляра Template.

### Место в Иерархии:
Если присутствуют оба файла, иерархия такая: Layout оборачивает Template, а Template оборачивает Page (или дочерний Layout). Layout -> Template -> Children.

## Критическое Сравнение: Состояние vs Пересоздание

| Аспект | layout.js | template.js |
|--------|-----------|-------------|
| **Состояние** | Сохраняется при навигации (в Client Comp.) | Сбрасывается при навигации |
| **DOM** | Сохраняется | Пересоздается |
| **useEffect** | Не перезапускается (если нет смены props) | Перезапускается (при монтировании нового инстанса) |
| **Основной Юзкейс** | Постоянные части UI (шапка, навбар, сайдбар) | Анимации входа/выхода, эффекты "при входе" на страницу |

## Зачем Понадобились Оба?

Наличие `template.js` решает специфические задачи, которые неудобно или невозможно реализовать с помощью `layout.js` из-за сохранения состояния:

- **Анимации Переходов**: Если вы хотите анимировать появление контента страницы при каждой навигации (например, fade-in), вам нужен компонент, который перемонтируется. Template идеально для этого подходит (часто используется с framer-motion или CSS-анимациями, запускаемыми в useEffect).

- **Эффекты "При Входе"**: Если вам нужно выполнить какой-то эффект (`useEffect`) каждый раз, когда пользователь заходит на любую страницу в определенном разделе (например, отправить аналитику, сбросить какое-то глобальное состояние), Template гарантирует, что эффект сработает при навигации.

- **Разделение Логики**: Иногда бывает удобно вынести логику, специфичную для перехода между страницами, в `template.js`, оставив в `layout.js` только действительно статичную обвязку.

## Критический Взгляд: Источник Путаницы?

- **Похожие Имена, Разное Поведение**: Наличие двух файлов (`layout.js`, `template.js`) в одной папке с похожим назначением (обертка для children), но кардинально разным поведением в отношении состояния — это потенциальный источник ошибок и непонимания для разработчиков, особенно для новичков в App Router.

- **Редкость Использования template.js**: На практике `template.js` требуется значительно реже, чем `layout.js`. В большинстве случаев сохранение состояния в Layout — это именно то, что нужно. Template — это инструмент для более специфических задач, в основном связанных с анимациями и эффектами при навигации.

- **Важность Документации**: Четкое понимание разницы между ними, описанной в документации Next.js, абсолютно необходимо, чтобы не использовать `template.js` там, где нужен `layout.js`, и наоборот.

## Итог

`layout.js` и `template.js` — это два механизма App Router для создания общих оболочек UI. Их главное отличие — в поведении при навигации: `layout.js` сохраняет состояние и не перемонтируется, обеспечивая постоянство UI, в то время как `template.js` перемонтируется при каждой навигации, сбрасывая состояние и перезапуская эффекты.

Layout используется для основной структуры (шапки, навигация). Template — более редкий инструмент, полезный в основном для анимаций переходов или логики, которая должна выполняться при каждой смене страницы внутри одного макета. Понимание этой разницы критично для правильного управления состоянием и UI-эффектами в App Router.
