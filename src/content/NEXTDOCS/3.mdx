# Тема 3: Pages Router vs App Router в Next.js: Две Эпохи, Две Философии

## Введение: Раскол в Next.js

С выходом Next.js 13 и стабилизацией App Router (директория `app/`) мир разработчиков на Next.js фактически разделился. Новый App Router существует параллельно с "классическим" Pages Router (директория `pages/`) и представляет собой не просто альтернативный способ организации файлов, а фундаментальный сдвиг в архитектуре, модели получения данных и даже в самой философии фреймворка.

Хотя они могут сосуществовать в одном проекте (что полезно для миграции), это два разных мира. В чем их ключевые различия, сильные и слабые стороны, и какой подход считать будущим? Давайте разберемся критически.

## Pages Router (Классический Подход, до Next.js 13)

### Роутинг:
Основан на файлах. Каждый React-компонент, экспортируемый по умолчанию из файла в директории `pages/` (кроме тех, что начинаются с `_`), автоматически становится страницей.
- `pages/index.js` -> `/`
- `pages/about.js` -> `/about`
- `pages/posts/[slug].js` -> `/posts/:slug` (динамический роут)

### Компонентная Модель:
По умолчанию все компоненты страниц и их дочерние компоненты — это классические клиентские React-компоненты. Они могут использовать `useState`, `useEffect` и выполняются (после гидратации) в браузере.

### Layout (Макет):
Общие для всех страниц макеты реализовывались через кастомный файл `pages/_app.js`, который оборачивал каждую страницу. Для кастомизации `<html>` и `<head>` использовался `pages/_document.js`. Это было не всегда удобно для создания вложенных макетов для разных разделов сайта.

### Получение Данных (Data Fetching):
Выполнялось до рендеринга страницы на сервере (или во время сборки) с помощью специальных экспортируемых функций из файла страницы:
- `getServerSideProps`: Для SSR (выполняется при каждом запросе).
- `getStaticProps`: Для SSG (выполняется при сборке).
- `getStaticPaths`: Для указания динамических путей при SSG.

Данные, полученные в этих функциях, передавались в компонент страницы через props.

## App Router (Новый Подход, Стабилен с Next.js 13.4+)

### Роутинг:
Основан на папках. Роут определяется наличием файла `page.js` (или `.jsx`/`.tsx`) внутри папки. Структура папок напрямую соответствует URL.
- `app/page.js` -> `/`
- `app/about/page.js` -> `/about`
- `app/posts/[slug]/page.js` -> `/posts/:slug`

### Компонентная Модель:
**React Server Components (RSC) по Умолчанию!** Это главное отличие. Все компоненты внутри директории `app/` по умолчанию являются Серверными Компонентами. Они:
- Рендерятся только на сервере.
- Не могут использовать хуки состояния (`useState`) или эффектов (`useEffect`).
- Могут быть асинхронными (`async`) и напрямую выполнять запросы к данным (например, к БД).
- Их JS не отправляется на клиент.

Чтобы сделать компонент клиентским (интерактивным, с хуками), его нужно явно пометить директивой `"use client";` в начале файла.

### Layouts:
Встроенная, мощная система вложенных макетов. Файл `layout.js` в папке определяет макет для этого сегмента пути и всех его дочерних сегментов. Лейауты сохраняют состояние при навигации между страницами внутри них. Есть также `template.js` (похож на layout, но пересоздается при навигации).

### Получение Данных:
Интегрировано с Server Components. Используется нативный `fetch` (расширенный Next.js для кэширования и дедупликации) и `async`/`await` прямо внутри серверных компонентов. Больше нет `getServerSideProps`/`getStaticProps`.

Статичность или динамичность рендеринга и данных определяется автоматически на основе того, как используются данные и вызываются ли динамические функции (`headers()`, `cookies()`, `searchParams`).

### Состояния Загрузки и Ошибок:
Встроенные конвенции через файлы `loading.js` (показывает UI пока данные грузятся) и `error.js` (обрабатывает ошибки в сегменте, использует Error Boundaries React).

## Ключевые Различия и "Конфликт Парадигм"

| Аспект | Pages Router | App Router | Критический Комментарий |
|--------|-------------|------------|--------------------------|
| **Философия** | Ближе к React SPA + SSR/SSG | Серверно-центричная архитектура + RSC | App Router — фундаментальный сдвиг в сторону сервера. |
| **Единица Роутинга** | Файл (page.js) | Папка + page.js | App Router более структурирован для сложных роутов. |
| **Компоненты (дефолт)** | Клиентские (useState/useEffect OK) | Серверные (RSC, нет useState/useEffect) | Огромное различие! Требует явного разделения на Client/Server с "use client"; |
| **Data Fetching** | getServerSideProps/getStaticProps (вне комп.) | fetch/async/await (внутри Server Component) | App Router интегрирует данные теснее с компонентом, но требует понимания нового кэширования и правил динамизма. |
| **Layouts** | _app.js + ручная логика | Встроенные вложенные layout.js (сохраняют state) | App Router значительно мощнее и удобнее для сложных макетов. |
| **Loading/Error UI** | Ручная реализация | Встроенные loading.js/error.js | App Router предоставляет удобные конвенции. |
| **Кэширование** | Явное (revalidate в getStaticProps) | Автоматическое, многоуровневое, сложное (fetch, Route Cache) | App Router мощнее, но сложнее в понимании и отладке. |

## Критический Взгляд: Будущее или Сложность?

### App Router как Стандарт Де-Факто:
Команда Next.js активно продвигает App Router и рекомендует его для всех новых проектов. Он решает многие архитектурные проблемы Pages Router (например, data fetching "водопадом") и открывает новые возможности с RSC.

### Кривая Обучения:
App Router значительно сложнее для освоения. Концепции RSC, различие Server/Client, новая модель data fetching и кэширования требуют серьезного пересмотра привычных подходов.

### Стабильность и Экосистема:
Pages Router — зрелый, стабильный, с огромной экосистемой. App Router новее, и хотя он стабилен, некоторые паттерны и интеграции с библиотеками (особенно state management) все еще находятся в процессе адаптации сообществом.

### Миграция:
Переход с Pages на App Router — это не просто рефакторинг, это часто переосмысление архитектуры приложения.

### Сосуществование:
Возможность использовать оба роутера в одном проекте — это плюс для плавной миграции, но может внести дополнительную сложность в поддержку проекта.

## Итог

Pages Router и App Router представляют собой две разные эпохи и две разные философии в развитии Next.js. Pages Router — это понятный и стабильный подход, эволюционировавший из мира React SPA. App Router — это амбициозный шаг в сторону серверно-центричной архитектуры с React Server Components, предлагающий потенциально лучшую производительность и новые паттерны, но ценой значительно возросшей сложности и необходимости переобучения.

Хотя App Router позиционируется как будущее, выбор между ними для конкретного проекта или команды должен учитывать кривую обучения, зрелость экосистемы и готовность принять новую парадигму. Понимание различий между ними абсолютно необходимо для любого современного Next.js разработчика.
